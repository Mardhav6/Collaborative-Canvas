<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Collaborative Canvas</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <aside id="sidebar">
      <div class="sidebar-header">
        <h1>Canvas</h1>
        <div class="room-badge">Room: <span id="room-name">lobby</span></div>
      </div>
      
      <div class="tool-section">
        <label class="section-label">Tool</label>
        <div class="tool-row">
          <button id="tool-brush" class="tool-btn active" title="Brush (B)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9.06 2.573a3.5 3.5 0 0 1 4.88 0l.586.586a3.5 3.5 0 0 1 1.097 1.097l.586.586a3.5 3.5 0 0 1 0 4.88l-8.293 8.293A5 5 0 0 1 2 18.586V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-2.414a5 5 0 0 1 1.464-3.536l8.293-8.293a3.5 3.5 0 0 1 0-4.88l-.586-.586a3.5 3.5 0 0 1-1.097-1.097l-.586-.586a3.5 3.5 0 0 1-4.88 0L9.06 2.573Z"/>
            </svg>
            Brush
          </button>
          <button id="tool-eraser" class="tool-btn" title="Eraser (E)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m7 21-4-4m0 0 4-4m-4 4h16M7 21h10a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2Z"/>
            </svg>
            Eraser
          </button>
        </div>
        <div class="tool-row" style="margin-top:8px;">
          <button id="tool-rect" class="tool-btn" title="Rectangle">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="4" y="4" width="16" height="16"/>
            </svg>
            Rect
          </button>
          <button id="tool-circle" class="tool-btn" title="Circle">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="8"/>
            </svg>
            Circle
          </button>
        </div>
        <div class="tool-row">
          <button id="tool-text" class="tool-btn" title="Text">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 6h16M12 6v12"/>
            </svg>
            Text
          </button>
          <button id="tool-image" class="tool-btn" title="Image URL">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18"/>
              <path d="M21 15l-5-5-4 4-2-2-5 5"/>
            </svg>
            Image
          </button>
        </div>
      </div>

      <div class="tool-section">
        <label class="section-label">Color</label>
        <div class="color-picker-wrapper">
          <input type="color" id="color-picker" value="#1f6feb" aria-label="Pick stroke color" title="Pick stroke color" />
          <span id="color-value">#1f6feb</span>
        </div>
      </div>

      <div class="tool-section">
        <label class="section-label">
          Stroke Width
          <span id="stroke-value">4px</span>
        </label>
        <input type="range" id="stroke-range" min="1" max="40" value="4" aria-label="Stroke width" title="Stroke width" />
      </div>

      <div class="tool-section">
        <label class="section-label">Actions</label>
        <div class="tool-row">
          <button id="undo-btn" class="action-btn" title="Undo (Ctrl+Z)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 7v6h6"/>
              <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/>
            </svg>
            Undo
          </button>
          <button id="redo-btn" class="action-btn" title="Redo (Ctrl+Y)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 7v6h-6"/>
              <path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"/>
            </svg>
            Redo
          </button>
        </div>
        <button id="clear-btn" class="action-btn danger" title="Clear Canvas">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          Clear
        </button>

        <div class="tool-row" style="margin-top:8px;">
          <button id="save-btn" class="action-btn" title="Save room to disk">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M7 21h10a2 2 0 0 0 2-2V7l-4-4H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2Z"/>
              <path d="M7 3v6h8"/>
            </svg>
            Save
          </button>
          <button id="load-btn" class="action-btn" title="Load room from disk">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <path d="M7 10l5-5 5 5"/>
              <path d="M12 15V3"/>
            </svg>
            Load
          </button>
        </div>
      </div>

      <div class="tool-section users-section">
        <label class="section-label">
          Online Users
          <span id="user-count" class="badge">0</span>
        </label>
        <ul id="user-list"></ul>
      </div>

      <div class="metrics">
        <div class="metric-item">
          <span class="metric-label">Latency</span>
          <span id="latency" class="metric-value">-</span>
        </div>
        <div class="metric-item">
          <span class="metric-label">FPS</span>
          <span id="fps" class="metric-value">-</span>
        </div>
      </div>

      <div class="tool-section">
        <label class="section-label">Debug</label>
        <label style="display:flex; align-items:center; gap:8px; font-size:13px; cursor:pointer;">
          <input type="checkbox" id="debug-render-order" />
          Show render order
        </label>
      </div>
    </aside>

    <main id="stage">
      <canvas id="canvas"></canvas>
    </main>
  </div>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    // Fallback: when hosted on Vercel and no SERVER_URL injected, point to Render server
    (function(){
      try {
        var isVercel = /vercel\.app$/.test(location.hostname);
        if (isVercel && !('SERVER_URL' in window) && !('SERVICE_SERVER_URL' in (window))) {
          window.SERVER_URL = 'https://collaborative-canvas-server-8lyl.onrender.com';
        }
      } catch(e) {}
    })();
  </script>
  <script src="./dist/bundle.js"></script>
</body>
</html>


